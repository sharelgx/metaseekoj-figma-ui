<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>å¿«é€Ÿæ£€æŸ¥</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1e293b;
            color: #e2e8f0;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            border-left: 4px solid #667eea;
            background: #334155;
        }
        .success { border-left-color: #10b981; }
        .error { border-left-color: #ef4444; }
        button {
            padding: 10px 20px;
            margin: 5px;
            font-size: 14px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>ğŸ” Scratch ç¼–è¾‘å™¨å¿«é€Ÿæ£€æŸ¥</h1>
    <div>
        <button onclick="checkAll()">ğŸš€ å¼€å§‹æ£€æŸ¥</button>
        <button onclick="openEditor()">ğŸ“ æ‰“å¼€ç¼–è¾‘å™¨</button>
        <button onclick="openProjects()">ğŸ“‹ æ‰“å¼€é¡¹ç›®åˆ—è¡¨</button>
    </div>
    <div id="results"></div>
    
    <script>
        function log(msg, type = 'info') {
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.textContent = msg;
            document.getElementById('results').appendChild(div);
        }
        
        async function checkAll() {
            document.getElementById('results').innerHTML = '';
            log('ğŸ” å¼€å§‹æ£€æŸ¥...', 'info');
            
            // 1. æ£€æŸ¥ç™»å½•çŠ¶æ€
            try {
                const res = await fetch('http://localhost:8086/api/profile/', {credentials: 'include'});
                const data = await res.json();
                if (data.error === null && data.data) {
                    log(`âœ… ç™»å½•çŠ¶æ€: å·²ç™»å½• (${data.data.real_name || 'ç”¨æˆ·'})`, 'success');
                } else {
                    log('âŒ ç™»å½•çŠ¶æ€: æœªç™»å½•', 'error');
                }
            } catch (e) {
                log('âŒ ç™»å½•æ£€æŸ¥å¤±è´¥: ' + e.message, 'error');
            }
            
            // 2. æ£€æŸ¥é¡¹ç›®åˆ—è¡¨
            try {
                const res = await fetch('http://localhost:8086/api/scratch/mystuff/', {credentials: 'include'});
                const projects = await res.json();
                log(`âœ… é¡¹ç›®æ€»æ•°: ${projects.length}`, 'success');
                
                const withThumbnail = projects.filter(p => p.cover_url).length;
                const withoutThumbnail = projects.filter(p => !p.cover_url).length;
                
                log(`âœ… æœ‰ç¼©ç•¥å›¾: ${withThumbnail} ä¸ª`, 'success');
                if (withoutThumbnail > 0) {
                    log(`âš ï¸ æ— ç¼©ç•¥å›¾: ${withoutThumbnail} ä¸ª`, 'error');
                }
            } catch (e) {
                log('âŒ é¡¹ç›®åˆ—è¡¨è·å–å¤±è´¥: ' + e.message, 'error');
            }
            
            // 3. æ£€æŸ¥é¡¹ç›®7
            try {
                const res = await fetch('http://localhost:8086/api/scratch/projects/7/', {credentials: 'include'});
                const project = await res.json();
                
                log(`âœ… é¡¹ç›®7æ ‡é¢˜: ${project.title}`, 'success');
                log(`âœ… data_jsonç±»å‹: ${typeof project.data_json}`, project.data_json && typeof project.data_json === 'object' ? 'success' : 'error');
                log(`âœ… æœ‰targets: ${project.data_json?.targets ? 'æ˜¯' : 'å¦'}`, project.data_json?.targets ? 'success' : 'error');
                log(`âœ… targetsæ•°é‡: ${project.data_json?.targets?.length || 0}`, 'success');
                log(`âœ… æœ‰ç¼©ç•¥å›¾: ${project.cover_url ? 'æ˜¯' : 'å¦'}`, project.cover_url ? 'success' : 'error');
            } catch (e) {
                log('âŒ é¡¹ç›®7æ£€æŸ¥å¤±è´¥: ' + e.message, 'error');
            }
            
            log('', 'info');
            log('âœ… åç«¯æ•°æ®æ£€æŸ¥å®Œæˆï¼', 'success');
            log('', 'info');
            log('ğŸ“ ä¸‹ä¸€æ­¥ï¼šç‚¹å‡»"æ‰“å¼€ç¼–è¾‘å™¨"æŒ‰é’®ï¼ŒæŸ¥çœ‹æ˜¯å¦æ˜¾ç¤ºç™»å½•çŠ¶æ€', 'info');
        }
        
        function openEditor() {
            window.open('http://localhost:8081/classroom/scratch/editor/7', '_blank');
        }
        
        function openProjects() {
            window.open('http://localhost:8081/classroom/scratch/projects', '_blank');
        }
        
        window.onload = () => {
            checkAll();
        };
    </script>
</body>
</html>

