<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>æµ‹è¯•ä¿å­˜å’ŒåŠ è½½</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }
        .log {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 500px;
            overflow-y: auto;
            margin-top: 10px;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background: #45a049;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            background: #f9f9f9;
            border-left: 4px solid #4CAF50;
        }
        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª Scratch é¡¹ç›®ä¿å­˜/åŠ è½½æµ‹è¯•</h1>
        
        <div>
            <button onclick="testGetProject()">ğŸ“‚ è·å–é¡¹ç›® 7</button>
            <button onclick="checkBlocksCount()">ğŸ” æ£€æŸ¥ç§¯æœ¨æ•°é‡</button>
            <button onclick="clearLog()">ğŸ—‘ï¸ æ¸…ç©ºæ—¥å¿—</button>
        </div>
        
        <div class="log" id="log"></div>
        
        <div class="result" id="result" style="display:none;"></div>
    </div>

    <script>
        let projectData = null;

        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#ff5555' : 
                         type === 'success' ? '#50fa7b' : 
                         type === 'warning' ? '#ffb86c' : '#0f0';
            logDiv.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        async function testGetProject() {
            log('=' .repeat(60));
            log('ğŸ“‚ æµ‹è¯•è·å–é¡¹ç›® 7', 'info');
            log('=' .repeat(60));

            try {
                const response = await fetch('http://localhost:8086/api/scratch/projects/7/', {
                    credentials: 'include'
                });

                if (!response.ok) {
                    log(`âŒ API è¯·æ±‚å¤±è´¥: ${response.status}`, 'error');
                    return;
                }

                const result = await response.json();
                
                if (result.error) {
                    log(`âŒ API è¿”å›é”™è¯¯: ${result.error}`, 'error');
                    return;
                }

                projectData = result.data;
                log(`âœ… é¡¹ç›®è·å–æˆåŠŸ`, 'success');
                log(`ğŸ“‹ é¡¹ç›® ID: ${projectData.id}`);
                log(`ğŸ“ é¡¹ç›®æ ‡é¢˜: ${projectData.title}`);
                log(`ğŸ•’ æ›´æ–°æ—¶é—´: ${projectData.updated_at}`);
                log('');
                
                // æ£€æŸ¥ data_json
                const dataJson = projectData.data_json;
                log(`ğŸ” data_json ç±»å‹: ${typeof dataJson}`);
                
                if (typeof dataJson === 'object' && dataJson !== null) {
                    log(`âœ… data_json æ˜¯å¯¹è±¡`, 'success');
                    log(`ğŸ“Š data_json keys: ${Object.keys(dataJson).join(', ')}`);
                    
                    if (dataJson.targets) {
                        log(`ğŸ¯ targets æ•°é‡: ${dataJson.targets.length}`);
                        
                        // æ£€æŸ¥æ¯ä¸ª target çš„ blocks
                        dataJson.targets.forEach((target, idx) => {
                            const blocksCount = Object.keys(target.blocks || {}).length;
                            log(`  Target ${idx} (${target.name}): ${blocksCount} blocks`);
                            
                            if (blocksCount > 0) {
                                log(`    ğŸ“¦ blocks: ${Object.keys(target.blocks).slice(0, 3).join(', ')}...`, 'success');
                            }
                        });
                    }
                } else {
                    log(`âš ï¸ data_json ä¸æ˜¯å¯¹è±¡: ${typeof dataJson}`, 'warning');
                }
                
                // æ£€æŸ¥å°é¢
                const coverUrl = projectData.cover_url;
                if (coverUrl) {
                    log(`ğŸ–¼ï¸ cover_url é•¿åº¦: ${coverUrl.length}`);
                    log(`ğŸ–¼ï¸ cover_url å‰50å­—ç¬¦: ${coverUrl.substring(0, 50)}`);
                } else {
                    log(`âš ï¸ cover_url ä¸ºç©º`, 'warning');
                }
                
                // æ˜¾ç¤ºå®Œæ•´æ•°æ®
                document.getElementById('result').style.display = 'block';
                document.getElementById('result').innerHTML = `
                    <h3>ğŸ“¦ å®Œæ•´é¡¹ç›®æ•°æ®</h3>
                    <pre>${JSON.stringify(projectData, null, 2).substring(0, 2000)}...</pre>
                `;
                
            } catch (error) {
                log(`âŒ å¼‚å¸¸: ${error.message}`, 'error');
                console.error(error);
            }
        }

        async function checkBlocksCount() {
            if (!projectData) {
                log('âš ï¸ è¯·å…ˆè·å–é¡¹ç›®æ•°æ®', 'warning');
                return;
            }

            log('=' .repeat(60));
            log('ğŸ” è¯¦ç»†æ£€æŸ¥ç§¯æœ¨æ•°é‡', 'info');
            log('=' .repeat(60));

            const dataJson = projectData.data_json;
            
            if (!dataJson || !dataJson.targets) {
                log('âŒ data_json æˆ– targets ä¸å­˜åœ¨', 'error');
                return;
            }

            let totalBlocks = 0;
            dataJson.targets.forEach((target, idx) => {
                const blocks = target.blocks || {};
                const blockCount = Object.keys(blocks).length;
                totalBlocks += blockCount;
                
                log(`Target ${idx}: ${target.name}`);
                log(`  ç§¯æœ¨æ•°é‡: ${blockCount}`);
                
                if (blockCount > 0) {
                    log(`  ç§¯æœ¨ IDs: ${Object.keys(blocks).slice(0, 5).join(', ')}`, 'success');
                    
                    // æ˜¾ç¤ºå‰3ä¸ªç§¯æœ¨çš„è¯¦ç»†ä¿¡æ¯
                    Object.entries(blocks).slice(0, 3).forEach(([blockId, block]) => {
                        log(`    ${blockId}: ${block.opcode}`, 'success');
                    });
                }
            });

            log('');
            log(`ğŸ“Š æ€»ç§¯æœ¨æ•°é‡: ${totalBlocks}`, totalBlocks > 0 ? 'success' : 'warning');
            
            if (totalBlocks === 0) {
                log('âš ï¸ é¡¹ç›®ä¸­æ²¡æœ‰ä»»ä½•ç§¯æœ¨ï¼è¿™å¯èƒ½æ˜¯é—®é¢˜æ‰€åœ¨', 'warning');
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•
        window.onload = () => {
            log('ğŸš€ æµ‹è¯•å·¥å…·å·²åŠ è½½');
            log('ğŸ’¡ ç‚¹å‡»"è·å–é¡¹ç›® 7"æŒ‰é’®å¼€å§‹æµ‹è¯•');
            log('');
        };
    </script>
</body>
</html>

