# ğŸ” Scratch ç¼–è¾‘å™¨ç™»å½•é—®é¢˜æ’æŸ¥

## â“ **ç”¨æˆ·é—®é¢˜**

> "ç”¨æˆ·è¿˜æ˜¯çœ‹ä¸åˆ°ç™»å½•æ¡†ï¼ŒåŸç‰ˆä¹Ÿè¿™æ ·å—ï¼Ÿ"

---

## ğŸ“‹ **é—®é¢˜åˆ†æ**

### **1. å®˜æ–¹ Scratch ç¼–è¾‘å™¨è¯´æ˜**

**é‡è¦**ï¼šå®˜æ–¹ Scratch 3.0 **ç¦»çº¿ç¼–è¾‘å™¨**ï¼ˆscratch-guiï¼‰**æœ¬èº«ä¸åŒ…å«ç™»å½•åŠŸèƒ½**ï¼

- âœ… **scratch.mit.edu ç½‘ç«™**ï¼šæœ‰å®Œæ•´çš„ç™»å½•/æ³¨å†ŒåŠŸèƒ½
- âŒ **ç‹¬ç«‹ Scratch ç¼–è¾‘å™¨**ï¼šé»˜è®¤æ²¡æœ‰ç™»å½•ç•Œé¢
- âš ï¸ **æˆ‘ä»¬çš„å®ç°**ï¼šåœ¨ç‹¬ç«‹ç¼–è¾‘å™¨ä¸­**æ·»åŠ **ç™»å½•åŠŸèƒ½

---

### **2. å½“å‰é…ç½®**

æˆ‘ä»¬åœ¨ `render-gui.jsx` ä¸­é…ç½®äº†ï¼š

```javascript
accountMenuOptions={{
    canHaveSession: true,    // âœ… å¯ç”¨ä¼šè¯
    canRegister: true,       // âœ… å¯ç”¨æ³¨å†Œ
    canLogin: true,          // âœ… å¯ç”¨ç™»å½•
    canLogout: userInfo.isLoggedIn,
    avatarUrl: userInfo.avatarUrl,
    myStuffUrl: '#/classroom/scratch/projects',
    profileUrl: userInfo.isLoggedIn ? `/profile/${userInfo.username}` : null,
    accountSettingsUrl: '/settings'
}}
```

---

### **3. æ˜¾ç¤ºæ¡ä»¶**

æ ¹æ® `menu-bar.jsx` çš„ä»£ç ï¼Œç™»å½•æŒ‰é’®æ˜¾ç¤ºéœ€è¦æ»¡è¶³ï¼š

```javascript
{menuOpts.canHaveSession ? (
    this.props.username ? (
        // å·²ç™»å½•ï¼šæ˜¾ç¤ºå¤´åƒå’Œä¸‹æ‹‰èœå•
    ) : (
        // æœªç™»å½•ï¼šæ˜¾ç¤º "åŠ å…¥ Scratch" å’Œ "ç™»å½•" æŒ‰é’®
        {menuOpts.canRegister ? (...) : null}
        {menuOpts.canLogin ? (...) : null}
    )
) : null}
```

**å…³é”®æ¡ä»¶**ï¼š
1. `canHaveSession === true` ï¼ˆâœ… å·²è®¾ç½®ï¼‰
2. `username === null` ï¼ˆæœªç™»å½•æ—¶ï¼‰
3. `canLogin === true` ï¼ˆâœ… å·²è®¾ç½®ï¼‰

---

## ğŸ”§ **å¯èƒ½çš„é—®é¢˜**

### **é—®é¢˜ 1ï¼šç”¨æˆ·ä¿¡æ¯è·å–å¤±è´¥**

**åŸå› **ï¼š`window.scratchUserInfo` æœªæ­£ç¡®è®¾ç½®æˆ–è·å–

**æ£€æŸ¥æ–¹æ³•**ï¼š
```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°è¾“å…¥
console.log(window.scratchUserInfo);
```

**æœŸæœ›è¾“å‡º**ï¼ˆæœªç™»å½•æ—¶ï¼‰ï¼š
```javascript
{
    isLoggedIn: false,
    username: null,
    avatarUrl: null
}
```

---

### **é—®é¢˜ 2ï¼šReact ç»„ä»¶æœªé‡æ–°æ¸²æŸ“**

**åŸå› **ï¼šä¿®æ”¹äº†é…ç½®ä½†ç¼–è¾‘å™¨æœªé‡æ–°ç¼–è¯‘

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# 1. åœæ­¢å½“å‰ç¼–è¾‘å™¨
lsof -ti:8601 | xargs kill -9

# 2. é‡æ–°ç¼–è¯‘
cd /home/sharelgx/MetaSeekOJdev/scratch-editor
./start-editor.sh
```

---

### **é—®é¢˜ 3ï¼šæµè§ˆå™¨ç¼“å­˜**

**åŸå› **ï¼šæµè§ˆå™¨ç¼“å­˜äº†æ—§ç‰ˆæœ¬çš„ç¼–è¾‘å™¨

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
2. å³é”®ç‚¹å‡»åˆ·æ–°æŒ‰é’®
3. é€‰æ‹©"æ¸…ç©ºç¼“å­˜å¹¶ç¡¬æ€§é‡æ–°åŠ è½½"

æˆ–è€…ï¼š
- Windows/Linux: `Ctrl + Shift + R`
- Mac: `Cmd + Shift + R`

---

### **é—®é¢˜ 4ï¼šiframe åµŒå…¥å¯¼è‡´çš„é—®é¢˜**

**åŸå› **ï¼šåœ¨ iframe ä¸­ï¼Œå…¨å±€å˜é‡å¯èƒ½æ— æ³•æ­£ç¡®ä¼ é€’

**æ£€æŸ¥æ–¹æ³•**ï¼š
```javascript
// åœ¨ç¼–è¾‘å™¨ iframe å†…éƒ¨çš„æ§åˆ¶å°ï¼ˆä¸æ˜¯å¤–å±‚é¡µé¢ï¼‰
console.log('User Info:', window.scratchUserInfo);
console.log('Login Handler:', typeof window.scratchLoginHandler);
```

---

## ğŸ¯ **éªŒè¯æ­¥éª¤**

### **æ­¥éª¤ 1ï¼šæ£€æŸ¥ç¼–è¾‘å™¨æ˜¯å¦è¿è¡Œ**

```bash
curl -s http://localhost:8601/ | grep -i "scratch"
```

âœ… **æœŸæœ›**ï¼šè¿”å› HTML å†…å®¹ï¼ŒåŒ…å« "Scratch 3.0 GUI"

---

### **æ­¥éª¤ 2ï¼šæ£€æŸ¥å‰ç«¯æ˜¯å¦è¿è¡Œ**

```bash
curl -s http://localhost:8081/ | grep -i "vite"
```

âœ… **æœŸæœ›**ï¼šè¿”å› HTML å†…å®¹ï¼ŒåŒ…å« Vite ç›¸å…³å†…å®¹

---

### **æ­¥éª¤ 3ï¼šè®¿é—®ç¼–è¾‘å™¨é¡µé¢**

æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®ï¼š
```
http://localhost:8081/classroom/scratch/editor
```

---

### **æ­¥éª¤ 4ï¼šæŸ¥æ‰¾ç™»å½•æŒ‰é’®**

**ä½ç½®**ï¼šScratch ç¼–è¾‘å™¨çš„**ç»¿è‰²é¡¶éƒ¨èœå•æ **ï¼Œ**æœ€å³ä¾§**

**å¦‚æœçœ‹åˆ°**ï¼š
- âœ… æ˜¾ç¤º "åŠ å…¥ Scratch" å’Œ "ç™»å½•" â†’ é…ç½®æˆåŠŸ
- âœ… æ˜¾ç¤ºå¤´åƒå’Œç”¨æˆ·å â†’ å·²ç™»å½•
- âŒ ä»€ä¹ˆéƒ½æ²¡æœ‰ â†’ é…ç½®å¤±è´¥

---

## ğŸ› ï¸ **è°ƒè¯•æ–¹æ³•**

### **æ–¹æ³• 1ï¼šæµè§ˆå™¨æ§åˆ¶å°**

1. æ‰“å¼€ `http://localhost:8081/classroom/scratch/editor`
2. æŒ‰ F12 æ‰“å¼€å¼€å‘è€…å·¥å…·
3. åˆ‡æ¢åˆ° **Console** æ ‡ç­¾
4. è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š

```javascript
// æ£€æŸ¥ç”¨æˆ·ä¿¡æ¯
console.log('User Info:', window.scratchUserInfo);

// æ£€æŸ¥å¤„ç†å™¨
console.log('Login Handler:', typeof window.scratchLoginHandler);
console.log('Register Handler:', typeof window.scratchRegisterHandler);
console.log('Logout Handler:', typeof window.scratchLogoutHandler);

// æ‰‹åŠ¨è§¦å‘ç™»å½•
if (window.scratchLoginHandler) {
    window.scratchLoginHandler();
}
```

---

### **æ–¹æ³• 2ï¼šç›´æ¥è®¿é—® Scratch ç¼–è¾‘å™¨**

è®¿é—®ï¼š
```
http://localhost:8601/
```

**æ³¨æ„**ï¼š
- å¦‚æœç›´æ¥è®¿é—® 8601 ç«¯å£ï¼Œ**æ²¡æœ‰å¤–å±‚ React åº”ç”¨**
- **ä¸ä¼šæœ‰** `window.scratchUserInfo` 
- **ä¸ä¼šæ˜¾ç¤º**ç™»å½•æŒ‰é’®ï¼ˆå› ä¸ºé…ç½®æ˜¯ç”±å¤–å±‚ React æä¾›çš„ï¼‰

**è¿™æ˜¯æ­£å¸¸çš„ï¼** å¿…é¡»é€šè¿‡ React å‰ç«¯è®¿é—®æ‰èƒ½çœ‹åˆ°ç™»å½•åŠŸèƒ½ã€‚

---

### **æ–¹æ³• 3ï¼šæ£€æŸ¥ iframe å…ƒç´ **

1. æ‰“å¼€ `http://localhost:8081/classroom/scratch/editor`
2. æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
3. åˆ‡æ¢åˆ° **Elements** æ ‡ç­¾
4. æ‰¾åˆ° `<iframe>` å…ƒç´ 
5. å³é”® â†’ "åœ¨æ–°æ ‡ç­¾é¡µä¸­æŸ¥çœ‹æ¡†æ¶" æˆ– "View frame source"
6. åœ¨ iframe çš„æ§åˆ¶å°ä¸­è¾“å…¥ï¼š
   ```javascript
   console.log(window.scratchUserInfo);
   ```

---

## âœ… **æ­£ç¡®çš„æ˜¾ç¤ºæ•ˆæœ**

### **æœªç™»å½•æ—¶**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Scratch Logo] æ–‡ä»¶ ç¼–è¾‘ ...  [åŠ å…¥Scratch] [ç™»å½•] â”‚  â† ç»¿è‰²èœå•æ 
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **å·²ç™»å½•æ—¶**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Scratch Logo] æ–‡ä»¶ ç¼–è¾‘ ...  [ğŸ“] [ğŸ‘¤ æŸ³è€å¸ˆ â–¼] â”‚  â† ç»¿è‰²èœå•æ 
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

ç‚¹å‡»ç”¨æˆ·åä¸‹æ‹‰ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æˆ‘çš„ä½œå“     â”‚
â”‚ è´¦æˆ·è®¾ç½®     â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚ é€€å‡ºç™»å½•     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ **å¿«é€Ÿä¿®å¤**

å¦‚æœå®Œå…¨çœ‹ä¸åˆ°ç™»å½•æŒ‰é’®ï¼Œè¯·æŒ‰ä»¥ä¸‹é¡ºåºæ“ä½œï¼š

```bash
# 1. åœæ­¢æ‰€æœ‰æœåŠ¡
lsof -ti:8601 | xargs kill -9
lsof -ti:8081 | xargs kill -9

# 2. é‡æ–°å¯åŠ¨ Scratch ç¼–è¾‘å™¨
cd /home/sharelgx/MetaSeekOJdev/scratch-editor
./start-editor.sh > /tmp/scratch-restart.log 2>&1 &

# 3. ç­‰å¾…ç¼–è¯‘å®Œæˆï¼ˆçº¦ 60 ç§’ï¼‰
sleep 60

# 4. é‡æ–°å¯åŠ¨ React å‰ç«¯
cd /home/sharelgx/MetaSeekOJdev/OnlineJudgeFE-React
npm run dev &

# 5. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜å¹¶è®¿é—®
# Ctrl + Shift + R (Windows/Linux)
# Cmd + Shift + R (Mac)
# http://localhost:8081/classroom/scratch/editor
```

---

## ğŸ“ **æ€»ç»“**

1. **å®˜æ–¹ Scratch ç¦»çº¿ç¼–è¾‘å™¨æœ¬èº«æ²¡æœ‰ç™»å½•åŠŸèƒ½**
2. **æˆ‘ä»¬æ·»åŠ äº†ç™»å½•åŠŸèƒ½**ï¼Œä½†éœ€è¦é€šè¿‡ React å‰ç«¯è®¿é—®
3. **å¿…é¡»è®¿é—®** `http://localhost:8081/classroom/scratch/editor`
4. **ä¸èƒ½ç›´æ¥è®¿é—®** `http://localhost:8601/`ï¼ˆä¼šç¼ºå°‘ç™»å½•é…ç½®ï¼‰
5. å¦‚æœçœ‹ä¸åˆ°ç™»å½•æŒ‰é’®ï¼Œæ£€æŸ¥ï¼š
   - âœ… æ˜¯å¦é€šè¿‡æ­£ç¡®çš„ URL è®¿é—®ï¼ˆ8081 ä¸æ˜¯ 8601ï¼‰
   - âœ… ç¼–è¾‘å™¨æ˜¯å¦å·²å®Œæˆç¼–è¯‘
   - âœ… æµè§ˆå™¨æ˜¯å¦æ¸…é™¤äº†ç¼“å­˜
   - âœ… `window.scratchUserInfo` æ˜¯å¦æ­£ç¡®è®¾ç½®

---

## ğŸ’¡ **ä¸‹ä¸€æ­¥**

å¦‚æœæŒ‰ç…§ä¸Šè¿°æ­¥éª¤æ“ä½œåä»ç„¶çœ‹ä¸åˆ°ç™»å½•æŒ‰é’®ï¼Œè¯·ï¼š

1. æˆªå›¾å½“å‰é¡µé¢
2. æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼Œè¾“å…¥ `window.scratchUserInfo`ï¼Œæˆªå›¾è¾“å‡º
3. æŸ¥çœ‹ `/tmp/scratch-restart.log` çš„æœ€å 50 è¡Œï¼Œæ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯
4. æä¾›ä»¥ä¸Šä¿¡æ¯ä»¥ä¾¿è¿›ä¸€æ­¥æ’æŸ¥

